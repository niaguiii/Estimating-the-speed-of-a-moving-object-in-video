# 视频中移动物体速度估计项目 🎬

> **基于AI的智能视频分析系统 - 从物体检测到速度估算的完整解决方案**

---

## 🎯 项目概述

### 📋 项目目标
开发一个**完整的视频中移动物体速度估计系统**，通过计算机视觉和深度学习技术：
- 🔍 **精确检测**视频中的各种移动物体
- 🎯 **稳定追踪**物体运动轨迹并分配唯一ID  
- 📏 **精确计算**物体在真实世界中的移动速度
- 🖥️ **友好界面**提供直观操作和结果展示

### 📈 分阶段实现路线图

```
🏆 第一阶段 - 基础检测追踪 ✅ 已完成
├── [√] 🤖 YOLOv8双版本检测系统 (ONNX + 原生)
├── [√] 🎯 SimpleTracker物体追踪算法
├── [√] 📹 完整视频处理管道
├── [√] 🖥️ 用户友好操作界面
├── [√] 🛠️ 错误处理和系统稳定性
├── [√] 🎨 美观可视化显示 (类别+置信度+ID)
└── [√] 📚 完整文档和使用指南

🔄 第二阶段 - ByteTrack集成与速度估算 (规划中)
├── [ ] 🚀 **ByteTrack高精度追踪** - 替换SimpleTracker
│   ├── [ ] 卡尔曼滤波运动预测
│   ├── [ ] 两阶段检测匹配策略
│   ├── [ ] IoU + 运动一致性匹配
│   └── [ ] 高密度场景优化 (精度: 60-70% → 80-90%)
├── [ ] 📐 **摄像头标定系统** - 像素到真实世界坐标转换
├── [ ] 📊 **轨迹分析引擎** - 物体运动路径分析
├── [ ] ⚡ **速度计算算法** - 基于标定数据的精确估算
└── [ ] 📋 **数据导出系统** - CSV/JSON格式分析结果

🎯 第三阶段 - 系统整合与Web界面 (规划中)  
├── [ ] 🌐 React/Vue Web前端界面开发
├── [ ] 🔌 RESTful API服务构建
├── [ ] 💾 数据库和存储系统
├── [ ] 🚀 云端系统部署和分发
└── [ ] 📱 移动端应用扩展
```

---

## 🏆 第一阶段成果展示

### ✨ 核心功能 
- ✅ **双版本检测** - YOLOv8原生版本 + ONNX版本，可灵活选择
- ✅ **智能追踪** - SimpleTracker算法，稳定ID分配与轨迹跟踪  
- ✅ **美观显示** - 优化的可视化界面，清晰显示物体类别、置信度和追踪ID
- ✅ **实时处理** - 支持视频实时显示和批量输出
- ✅ **自动配置** - 一键安装，解决PyYAML冲突等依赖问题
- ✅ **错误恢复** - 多层备选，确保系统稳定运行

### 🎮 快速体验
```bash
# 🚀 一键启动（推荐）
install.bat        # Windows - 双击运行

# 📱 手动启动
python main.py     # 统一入口，可选择ONNX或原生版本

# 🔧 高级用法
python main_yolov8_native.py --input video.mp4 --conf 0.25  # 原生版本，可调置信度
python main_opencv.py --input video.mp4                      # ONNX版本，稳定快速
```

### 📊 性能表现
| 视频规格 | 处理速度 | 检测精度 | 内存占用 |
|---------|----------|----------|----------|
| 640×480 | 8-12 FPS | YOLOv8级 | ~200MB |
| 1280×720 | 5-8 FPS | 高精度 | ~400MB |
| 1920×1080 | 3-5 FPS | 适合分析 | ~600MB |

---

## 🚀 快速开始

### 💾 安装方式

#### 方法1：一键安装（推荐新手）
```bash
# Windows用户 - 双击任一文件
install.bat        # 命令提示符版本
install.ps1        # PowerShell版本

# 自动完成：环境检测 → 依赖安装 → 模型下载 → 测试验证
```

#### 方法2：手动安装（开发者）
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 启动程序
python main.py
```

### 🎬 使用流程

```
1️⃣ 准备视频
   └── 将视频文件放入 input/ 文件夹（可选，程序可自动生成测试视频）

2️⃣ 运行程序  
   └── python main.py

3️⃣ 选择设置
   ├── 选择要处理的视频文件
   ├── 选择检测模型版本 (ONNX稳定版 / 原生高精度版)
   └── 选择是否显示实时处理窗口

4️⃣ 查看结果
   └── 在 output/ 文件夹查看带检测框和追踪ID的结果视频
```

### 🔧 版本选择指南

| 版本 | 适用场景 | 优势 | 推荐用途 |
|------|----------|------|----------|
| **ONNX版本** | 稳定环境，快速部署 | 兼容性好，无依赖冲突 | 生产环境，演示展示 |
| **原生版本** | 高精度需求，研究开发 | 精度更高，参数可调 | 算法研究，精确分析 |

### 📁 项目结构
```
📦 项目根目录/
├── 📂 input/              # 输入视频存放处
├── 📂 output/             # 处理结果输出
├── 📂 models/             # AI模型文件
│   ├── yolov8n.pt        # YOLOv8原生模型 (6.2MB)
│   ├── yolov8n.onnx      # YOLOv8 ONNX模型 (3.8MB) 
│   └── coco.names        # 80类物体标签
├── 📂 docs/              # 技术文档
│   ├── ARCHITECTURE.md   # 系统架构设计
│   └── INSTALLATION.md   # 详细安装指南
├── 🚀 main.py            # 程序主入口 (统一版本选择)
├── ⚙️ main_opencv.py     # ONNX版本检测引擎 (稳定)
├── 🔥 main_yolov8_native.py  # 原生版本检测引擎 (高精度)
├── 🔧 config.py          # 系统配置文件
├── 🧪 setup_and_test.py  # 环境配置工具
├── 🏗️ install.bat/.ps1   # 一键安装脚本
└── 📚 README.md          # 本说明文档
```

---

## 🎯 功能展示

### 🔍 检测能力
```
支持检测物体类型（80种COCO类别）：
🚶 人类相关: 人员、自行车、摩托车
🚗 交通工具: 汽车、公交车、卡车、火车、飞机、船只  
🐕 动物类别: 猫、狗、马、牛、羊、大象等
📱 日常物品: 手机、笔记本电脑、背包、雨伞等
```

### 📈 处理效果演示
```
📹 输入视频: input/street_video.mp4
     ↓ AI检测 + 智能追踪
📹 输出视频: output/street_video_result.mp4
     ├── 🟢 彩色检测框 (不同物体不同颜色)
     ├── 🏷️ 物体类别标签 (person, car, bicycle...)  
     ├── 🆔 唯一追踪ID (ID:1, ID:2, ID:3...)
     └── 📊 实时统计 (帧数、物体数量)
```

### 🖥️ 程序界面示例
```
============================================================
🎯 视频中移动物体速度估计项目 - 第一阶段
============================================================
功能:
  ✅ 物体检测 (YOLOv8 + OpenCV DNN)
  ✅ 物体追踪 (ID分配和轨迹跟踪)  
  ✅ 视频分析 (帧数、帧率统计)
============================================================

📹 找到 1 个视频文件:
  1. test_video.mp4

请选择视频 (1-1): 1
✅ 已选择: test_video.mp4

🚀 开始处理视频...
正在初始化检测器...
✅ YOLOv8/YOLOv5 ONNX模型加载成功

处理进度: 33.3%
处理进度: 66.7%  
处理进度: 100.0%
✅ 处理完成，共处理 90 帧
```

---

## 🔧 环境要求

### 💻 系统要求
- **操作系统**: Windows 10/11, Linux, macOS
- **Python版本**: 3.7+ (推荐3.9+)
- **内存**: 4GB+ (处理高清视频建议8GB+)
- **存储**: 1GB可用空间

### 📦 核心依赖
```python
opencv-python>=4.5.0    # 计算机视觉核心库
numpy>=1.21.0           # 数值计算基础
# 其他依赖详见 requirements.txt
```

### ⚙️ 配置调整
编辑 `config.py` 可自定义：
```python
# 检测参数
confidence_threshold = 0.5    # 检测置信度阈值
nms_threshold = 0.4          # 重叠框过滤阈值

# 追踪参数  
max_distance = 100           # 最大关联距离
max_disappeared = 10         # 物体消失帧数限制
```

---

## 🛠️ 故障排除

### ❓ 常见问题

#### 1. 程序无法启动
```bash
# 问题：运行 python main.py 报错
# 解决：检查环境配置
python setup_and_test.py    # 运行系统诊断
```

#### 2. 找不到YOLOv8模型
```bash
# 现象：显示"模型加载失败"
# 说明：程序会自动降级到人脸检测，仍可演示功能
# 优化：手动下载YOLOv8模型到 models/ 文件夹
```

#### 3. 视频处理慢
```bash
# 现象：处理时间过长
# 优化：
# - 使用较小分辨率的视频文件
# - 关闭实时显示窗口 (选择n)
# - 调整config.py中的检测阈值
```

#### 4. 内存不足
```bash
# 现象：处理大视频时程序崩溃
# 解决：
# - 分段处理长视频
# - 降低输入视频分辨率  
# - 关闭其他占内存的程序
```

### 📞 获取帮助
- 📖 详细安装: `docs/INSTALLATION.md`
- 🏗️ 技术架构: `docs/ARCHITECTURE.md`  
- 🔧 系统诊断: `python setup_and_test.py`
- 📝 处理日志: 查看 `logs/` 文件夹

---

## 🔮 未来发展规划

### 🎯 第二阶段：深度优化与速度估算
**目标时间：** 2-3个月

#### 🔬 技术升级内容
- **深度追踪算法**: 集成DeepSORT/ByteTrack，提升追踪精度
- **摄像头标定**: 支持相机内参标定，实现像素到实际距离转换
- **轨迹分析引擎**: 物体运动轨迹的平滑处理和预测
- **速度计算系统**: 基于轨迹数据计算真实世界速度(km/h, m/s)

#### 📊 预期成果
```
轨迹数据 → 坐标转换 → 距离计算 → 时间分析 → 速度输出
   ↓         ↓         ↓         ↓         ↓
像素坐标   真实坐标   移动距离   时间间隔   km/h速度
```

### 🌐 第三阶段：系统整合与前端界面  
**目标时间：** 1-2个月

#### 🖥️ 用户界面开发
- **Web前端**: 现代响应式界面，支持拖拽上传
- **实时预览**: 在线视频处理和实时结果展示
- **数据可视化**: 速度曲线图、统计图表、热力图
- **批量处理**: 支持多文件并行处理

#### 🔌 系统架构扩展
```
🌐 完整系统架构
├── 前端界面 (React/Vue.js)
├── 后端API (FastAPI/Flask)
├── 处理引擎 (当前Python系统)  
├── 数据库 (SQLite/PostgreSQL)
└── 部署服务 (Docker/云端)
```

#### 🚀 部署方案
- **桌面应用**: 打包为exe可执行文件
- **Web应用**: 支持在线访问和使用
- **API服务**: 提供RESTful接口供第三方调用
- **移动端**: 可能的移动应用扩展

---

## 🤝 开发与贡献

### 🔧 开发环境搭建
```bash
# 1. 克隆项目
git clone [项目地址]
cd [项目目录]

# 2. 创建虚拟环境（推荐）
python -m venv venv
venv\Scripts\activate    # Windows
# source venv/bin/activate  # Linux/macOS

# 3. 安装开发依赖
pip install -r requirements.txt

# 4. 运行测试验证
python setup_and_test.py
```

### 📝 贡献指南
- **代码规范**: 遵循PEP8 Python编码标准
- **提交规范**: 清晰的commit信息和PR描述
- **测试要求**: 提交前运行完整功能测试
- **文档更新**: 保持代码注释和文档同步

### 🎯 欢迎贡献的方向
- 🔧 **算法优化**: 改进检测和追踪算法
- 🎨 **界面设计**: 用户界面和体验优化
- 📚 **文档完善**: 教程、示例、FAQ等
- 🐛 **问题修复**: Bug报告和修复
- 🚀 **功能扩展**: 新功能和创新想法

---

## 📞 项目信息

### 📋 基本信息
- **项目类型**: 计算机视觉 / 深度学习应用
- **技术栈**: Python + OpenCV + YOLOv8 + Ultralytics + ONNX
- **追踪算法**: SimpleTracker (当前) → ByteTrack (下阶段)
- **开源协议**: MIT License  
- **开发状态**: 第一阶段完成，第二阶段规划中

### 🙏 致谢
感谢以下开源项目和技术社区的支持：
- **OpenCV** - 强大的计算机视觉库
- **YOLOv8/Ultralytics** - 先进的目标检测算法
- **ByteTrack** - 业界领先的多目标追踪算法 (规划集成)
- **ONNX** - 跨平台深度学习模型标准
- **Python社区** - 丰富的开源生态系统

---

**🎊 第一阶段圆满完成！YOLOv8双版本检测追踪系统稳定运行，ByteTrack集成规划就绪，为实现完整的视频速度估计解决方案奠定了坚实的技术基础。**