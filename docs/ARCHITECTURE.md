# æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### åˆ†å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚                             â”‚
â”‚   main.py (ç»Ÿä¸€å…¥å£) â”‚ install.bat/ps1 (ä¸€é”®å®‰è£…)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨é€»è¾‘å±‚                             â”‚
â”‚ main_opencv.py (ONNXç‰ˆ) â”‚ main_yolov8_native.py (åŸç”Ÿç‰ˆ) â”‚
â”‚              config.py (ç³»ç»Ÿé…ç½®)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AIç®—æ³•å±‚                              â”‚
â”‚ YOLOv8æ£€æµ‹ â”‚ SimpleTrackerè¿½è¸ª â”‚ ç¾è§‚æ˜¾ç¤º â”‚ é”™è¯¯æ¢å¤      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¡†æ¶å±‚                                â”‚
â”‚ OpenCV DNN (ONNX) â”‚ Ultralytics (åŸç”Ÿ) â”‚ OpenCV Core     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ æ•°æ®å¤„ç†æµç¨‹

### å½“å‰æµç¨‹ (ç¬¬ä¸€é˜¶æ®µ)
```
è¾“å…¥è§†é¢‘ â†’ å¸§æå– â†’ YOLOv8æ£€æµ‹ â†’ SimpleTracker â†’ ç¾è§‚æ¸²æŸ“ â†’ è¾“å‡ºè§†é¢‘
   â”‚         â”‚         â”‚          â”‚             â”‚          â”‚
  MP4     OpenCV   ONNX/åŸç”Ÿ    è·ç¦»åŒ¹é…      ç±»åˆ«+IDæ˜¾ç¤º  ä¿å­˜æ–‡ä»¶
```

### è§„åˆ’æµç¨‹ (ç¬¬äºŒé˜¶æ®µ - ByteTracké›†æˆ)
```
è¾“å…¥è§†é¢‘ â†’ å¸§æå– â†’ YOLOv8æ£€æµ‹ â†’ ByteTrack â†’ é€Ÿåº¦è®¡ç®— â†’ è¾“å‡ºåˆ†æ
   â”‚         â”‚         â”‚          â”‚         â”‚          â”‚
  MP4     OpenCV   ONNX/åŸç”Ÿ   å¡å°”æ›¼æ»¤æ³¢  çœŸå®é€Ÿåº¦    CSV/JSON
                              ä¸¤é˜¶æ®µåŒ¹é…
```

## ğŸ§© æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. YOLOv8æ£€æµ‹å¼•æ“ (main_opencv.py)

#### OpenCVObjectDetectorç±»
```python
class OpenCVObjectDetector:
    def __init__(self):
        self.net = None
        self.model_type = None  # 'onnx' æˆ– 'cascade'
        self.setup_yolo_model()
    
    def setup_yolo_model(self):
        """æ™ºèƒ½æ¨¡å‹åŠ è½½ï¼šONNX -> å¤‡ç”¨æ£€æµ‹"""
        if os.path.exists('models/yolov8n.onnx'):
            self.net = cv2.dnn.readNetFromONNX('models/yolov8n.onnx')
            self.model_type = 'onnx'
        else:
            self.setup_fallback_detector()  # äººè„¸æ£€æµ‹å¤‡ç”¨
```

#### YOLOv8 ONNXå®ç°ç»†èŠ‚
- **è¾“å…¥æ ¼å¼**: 640Ã—640 RGBå›¾åƒï¼Œå½’ä¸€åŒ–åˆ°[0,1]
- **è¾“å‡ºæ ¼å¼**: [1, 84, 8400] å¼ é‡
- **åå¤„ç†**: ç½®ä¿¡åº¦ç­›é€‰ â†’ NMS â†’ åæ ‡è½¬æ¢

### 2. ç‰©ä½“è¿½è¸ªç®—æ³•

#### SimpleTrackerç±»
```python
class SimpleTracker:
    def __init__(self):
        self.tracks = []           # å½“å‰è¿½è¸ªåˆ—è¡¨
        self.next_id = 1          # IDç”Ÿæˆå™¨
        self.max_disappeared = 10  # æ¶ˆå¤±é˜ˆå€¼
    
    def update(self, detections):
        """æ ¸å¿ƒè¿½è¸ªé€»è¾‘"""
        # 1. è·ç¦»åŒ¹é…ï¼šæ¬§å‡ é‡Œå¾—è·ç¦»æœ€è¿‘é‚»
        # 2. IDåˆ†é…ï¼šæ–°ç‰©ä½“åˆ†é…æ–°ID
        # 3. çŠ¶æ€ç®¡ç†ï¼šæ¶ˆå¤±è®¡æ•°å™¨
```

#### è¿½è¸ªç®—æ³•ç‰¹ç‚¹
- **åŒ¹é…ç­–ç•¥**: åŸºäºä¸­å¿ƒç‚¹è·ç¦»çš„è´ªå©ªåŒ¹é…
- **IDç®¡ç†**: å•è°ƒé€’å¢ï¼Œé¿å…IDé‡å¤
- **çŠ¶æ€ç»´æŠ¤**: ç®€å•æœ‰æ•ˆçš„æ¶ˆå¤±/é‡ç°å¤„ç†

### 3. ç”¨æˆ·ç•Œé¢ç³»ç»Ÿ (main.py)

#### é—¨é¢æ¨¡å¼è®¾è®¡
```python
def main():
    """ç”¨æˆ·å‹å¥½çš„ç»Ÿä¸€å…¥å£"""
    setup_directories()          # è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹
    videos = get_input_videos()  # æ‰«æè¾“å…¥è§†é¢‘
    selected = select_video()    # ç”¨æˆ·é€‰æ‹©
    output_path = get_output_filename()  # è‡ªåŠ¨å‘½å
    
    # è°ƒç”¨æ ¸å¿ƒå¼•æ“
    from main_opencv import process_video
    process_video(selected, output_path)
```

## ğŸ¯ å…³é”®æŠ€æœ¯å†³ç­–

### AIæ¨¡å‹é€‰æ‹©

| æ–¹æ¡ˆ | ç²¾åº¦ | é€Ÿåº¦ | å…¼å®¹æ€§ | æœ€ç»ˆé€‰æ‹© |
|------|------|------|--------|----------|
| YOLOv8 ONNX | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | âœ… **é‡‡ç”¨** |
| äººè„¸æ£€æµ‹ | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ğŸ›¡ï¸ **å¤‡ç”¨** |

### æ¶æ„ä¼˜åŠ¿

#### 1. æ™ºèƒ½é™çº§æœºåˆ¶
```python
def create_detector():
    try:
        return YOLOv8Detector()      # ä¸»åŠ›æ–¹æ¡ˆ
    except ModelNotFoundError:
        return FaceDetector()        # ä¿åº•æ–¹æ¡ˆ
```

#### 2. é›¶ä¾èµ–å†²çª
- **çº¯OpenCVå®ç°**: é¿å…æ·±åº¦å­¦ä¹ æ¡†æ¶å†²çª
- **ONNXæ ‡å‡†**: è·¨å¹³å°æ¨¡å‹æ ¼å¼
- **æœ€å°ä¾èµ–**: ä»…éœ€opencv-pythonå’Œnumpy

#### 3. å†…å­˜ä¼˜åŒ–
- **é€å¸§å¤„ç†**: é¿å…æ•´ä¸ªè§†é¢‘åŠ è½½åˆ°å†…å­˜
- **å³æ—¶é‡Šæ”¾**: å¤„ç†å®Œçš„å¸§ç«‹å³é‡Šæ”¾
- **æµå¼è®¾è®¡**: æ”¯æŒä»»æ„é•¿åº¦è§†é¢‘

## ğŸš€ æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### è®¡ç®—ä¼˜åŒ–
```python
# ONNXæ¨ç†ä¼˜åŒ–
blob = cv2.dnn.blobFromImage(frame, 1/255.0, (640, 640), swapRB=True)
net.setInput(blob)
outputs = net.forward()  # OpenCV DNNç¡¬ä»¶ä¼˜åŒ–

# å†…å­˜ç®¡ç†
del frame, outputs  # ä¸»åŠ¨é‡Šæ”¾å¤§å¯¹è±¡
```

### è¿½è¸ªä¼˜åŒ–
```python
# è·ç¦»è®¡ç®—ä¼˜åŒ–
def calculate_distance(p1, p2):
    return np.sqrt((p1[0] - p2[0])**2 + (p1[1] - p2[1])**2)

# é¿å…å…¨å¯¹å…¨è®¡ç®—ï¼Œä½¿ç”¨è·ç¦»é˜ˆå€¼æå‰å‰ªæ
```

## ğŸ”§ é…ç½®ç³»ç»Ÿè®¾è®¡

### é›†ä¸­é…ç½®ç®¡ç† (config.py)
```python
YOLO_CONFIG = {
    'onnx_model': 'models/yolov8n.onnx',
    'confidence_threshold': 0.5,
    'nms_threshold': 0.4,
    'input_size': (640, 640)
}

TRACKING_CONFIG = {
    'max_distance': 100,        # åƒç´ 
    'max_disappeared': 10       # å¸§æ•°
}
```

### å¯æ‰©å±•è®¾è®¡
- **æ’ä»¶åŒ–æ£€æµ‹å™¨**: æ˜“äºæ›¿æ¢ä¸åŒAIæ¨¡å‹
- **é…ç½®é©±åŠ¨**: å…³é”®å‚æ•°å¯è°ƒæ•´
- **æ¥å£æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„æ£€æµ‹å’Œè¿½è¸ªAPI

## ğŸ”® æœªæ¥æ‰©å±•æ¶æ„

### ç¬¬äºŒé˜¶æ®µï¼šé€Ÿåº¦è®¡ç®—æ‰©å±•
```python
class SpeedCalculator:
    def __init__(self):
        self.calibration = CameraCalibration()
        self.trajectory = TrajectoryAnalyzer()
    
    def calculate_speed(self, tracks, time_delta):
        """åƒç´ è½¨è¿¹ â†’ çœŸå®é€Ÿåº¦"""
        # 1. åæ ‡è½¬æ¢ï¼šåƒç´  â†’ ä¸–ç•Œåæ ‡
        # 2. è·ç¦»è®¡ç®—ï¼šè½¨è¿¹é•¿åº¦
        # 3. é€Ÿåº¦è®¡ç®—ï¼šè·ç¦»/æ—¶é—´
```

### ç¬¬ä¸‰é˜¶æ®µï¼šWebæœåŠ¡æ¶æ„
```python
# FastAPIåç«¯
@app.post("/api/process_video")
async def process_video_api(video: UploadFile):
    # è°ƒç”¨å½“å‰æ£€æµ‹å¼•æ“
    result = await process_video_async(video)
    return {"speed_data": result}

# å‰ç«¯React/Vue.js
// è§†é¢‘ä¸Šä¼  â†’ APIè°ƒç”¨ â†’ ç»“æœå±•ç¤º
```

## ğŸ“Š æ€§èƒ½ç›‘æ§

### å…³é”®æŒ‡æ ‡
- **æ£€æµ‹å»¶è¿Ÿ**: å•å¸§æ£€æµ‹æ—¶é—´
- **å†…å­˜ä½¿ç”¨**: å³°å€¼å†…å­˜å ç”¨
- **è¿½è¸ªç²¾åº¦**: IDåˆ‡æ¢é¢‘ç‡
- **ç³»ç»Ÿç¨³å®šæ€§**: é”™è¯¯æ¢å¤æˆåŠŸç‡

### ç›‘æ§å®ç°
```python
class PerformanceMonitor:
    def track_detection_time(self, start_time):
        self.detection_times.append(time.time() - start_time)
    
    def log_memory_usage(self):
        memory_mb = psutil.Process().memory_info().rss / 1024 / 1024
        self.memory_usage.append(memory_mb)
```

## ğŸ¯ æ¶æ„æ¼”è¿›è·¯å¾„

```
å½“å‰æ¶æ„ (ç¬¬ä¸€é˜¶æ®µ) âœ…
â”œâ”€â”€ åŒç‰ˆæœ¬YOLOv8æ£€æµ‹ (ONNX + åŸç”Ÿ)
â”œâ”€â”€ SimpleTrackerè¿½è¸ª
â”œâ”€â”€ ç¾è§‚å¯è§†åŒ–æ˜¾ç¤º
â””â”€â”€ å®Œæ•´è§†é¢‘å¤„ç†ç®¡é“

é€Ÿåº¦è®¡ç®—æ¶æ„ (ç¬¬äºŒé˜¶æ®µ) ğŸ”„
â”œâ”€â”€ ByteTracké«˜ç²¾åº¦è¿½è¸ª
â”‚   â”œâ”€â”€ å¡å°”æ›¼æ»¤æ³¢é¢„æµ‹
â”‚   â”œâ”€â”€ ä¸¤é˜¶æ®µåŒ¹é…ç­–ç•¥
â”‚   â””â”€â”€ IoU + è¿åŠ¨ä¸€è‡´æ€§
â”œâ”€â”€ æ‘„åƒå¤´æ ‡å®šç³»ç»Ÿ
â”œâ”€â”€ è½¨è¿¹åˆ†æå¼•æ“
â””â”€â”€ ç²¾ç¡®é€Ÿåº¦è®¡ç®—

å®Œæ•´ç³»ç»Ÿæ¶æ„ (ç¬¬ä¸‰é˜¶æ®µ) ğŸ“‹
â”œâ”€â”€ RESTful APIæœåŠ¡å±‚
â”œâ”€â”€ React/Vue Webå‰ç«¯
â”œâ”€â”€ æ•°æ®åº“å­˜å‚¨ç³»ç»Ÿ
â””â”€â”€ äº‘ç«¯éƒ¨ç½²ä¼˜åŒ–
```

## ğŸš€ ByteTracké›†æˆæŠ€æœ¯è§„åˆ’

### æ¶æ„å¯¹æ¯”
| ç»„ä»¶ | SimpleTracker (å½“å‰) | ByteTrack (è§„åˆ’) |
|------|---------------------|------------------|
| **åŒ¹é…ç­–ç•¥** | è·ç¦»æœ€è¿‘é‚» | ä¸¤é˜¶æ®µæ£€æµ‹åŒ¹é… |
| **è¿åŠ¨é¢„æµ‹** | æ—  | å¡å°”æ›¼æ»¤æ³¢ |
| **ç›¸ä¼¼åº¦è®¡ç®—** | æ¬§æ°è·ç¦» | IoU + è¿åŠ¨ + å¤–è§‚ |
| **é®æŒ¡å¤„ç†** | disappearedè®¡æ•° | ä½ç½®ä¿¡åº¦æ¢å¤ |
| **ç²¾åº¦** | ~60-70% | ~80-90% |

### é›†æˆå®ç°è®¡åˆ’
```python
# ç¬¬äºŒé˜¶æ®µç›®æ ‡æ¶æ„
class ByteTrackDetector:
    def __init__(self):
        self.yolo_detector = YOLOv8Detector()
        self.byte_tracker = BYTETracker()
        self.kalman_filter = KalmanFilter()
    
    def track_objects(self, frame):
        # é«˜ä½ç½®ä¿¡åº¦åˆ†ç¦»
        high_conf_dets, low_conf_dets = self.separate_detections(frame)
        
        # ä¸¤é˜¶æ®µåŒ¹é…
        tracks = self.byte_tracker.update(high_conf_dets, low_conf_dets)
        
        return tracks
```

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ç³»ç»Ÿçš„**é«˜æ€§èƒ½**ã€**é«˜å¯é æ€§**å’Œ**å¼ºæ‰©å±•æ€§**ï¼Œä¸ºå®ç°å®Œæ•´çš„é€Ÿåº¦ä¼°è®¡è§£å†³æ–¹æ¡ˆæä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚